"use strict";JEU_PACMAN_RUNNER.Jeu=function(){this.couches=null,this.carteGauche=[],this.carteDroite=[],this.murs=null,this.positionDeroulement=0,this.pacman=null,this.score=0,this.scoreTxt=null,this.tempsEcoule=0,this.tempsTxt=null,this.nbFantomesMax=null,this.barrePowerUp=null,this.sonTuile=null},JEU_PACMAN_RUNNER.Jeu.prototype={init:function(){this.nbFantomesMax=JEU_PACMAN_RUNNER.NB_FANTOMES_MAX,this.positionDeroulement=0},create:function(){this.sonTuile=this.game.add.audio("sonTuile",.5),this.game.camera.bounds=null,this.couches={carte:this.game.add.group(),gommes:this.game.add.group(),fantomes:this.game.add.group(),pacman:this.game.add.group()},this.game.physics.startSystem(Phaser.Physics.ARCADE),this.murs={droit:this.game.add.tileSprite(this.game.width,0,JEU_PACMAN_RUNNER.TAILLE_TUILE,this.game.height,"tuiles_32",1),haut:this.game.add.tileSprite(0,-JEU_PACMAN_RUNNER.TAILLE_TUILE,this.game.width,JEU_PACMAN_RUNNER.TAILLE_TUILE,"tuiles_32",1),bas:this.game.add.tileSprite(0,16*JEU_PACMAN_RUNNER.TAILLE_TUILE,this.game.width,JEU_PACMAN_RUNNER.TAILLE_TUILE,"tuiles_32",1)},this.game.physics.enable([this.murs.droit,this.murs.haut,this.murs.bas],Phaser.Physics.ARCADE),this.murs.droit.body.immovable=!0,this.murs.haut.body.immovable=!0,this.murs.bas.body.immovable=!0,this.murs.droit.fixedToCamera=!0,this.murs.haut.fixedToCamera=!0,this.murs.bas.fixedToCamera=!0,this.creerCarteJeu(JEU_PACMAN_RUNNER.CARTE_DEBUT,0,!1),this.creerCarteJeu(),this.pacman=new Pacman(this.game,this.couches.pacman,150),this.pacman.setPositionDepart(JEU_PACMAN_RUNNER.POS_DEPART_PERSO[0]*JEU_PACMAN_RUNNER.TAILLE_TUILE+2,JEU_PACMAN_RUNNER.POS_DEPART_PERSO[1]*JEU_PACMAN_RUNNER.TAILLE_TUILE+2),this.score=0,this.scoreTxt=this.game.add.text(this.game.width/2,this.game.height,"SCORE = 0",{font:"bold 36px Arial",fill:"#FFF"}),this.scoreTxt.anchor.set(.5,2),this.scoreTxt.fixedToCamera=!0,this.game.time.reset(),this.tempsTxt=this.game.add.text(this.game.width/2,this.game.height,"TEMPS ÉCOULÉ = 0",{font:"bold 16px Arial",fill:"#FFF"}),this.tempsTxt.anchor.set(.5,2),this.tempsTxt.fixedToCamera=!0,this.barrePowerUp=this.game.add.sprite(0,this.game.height/4*3+32,"barreChargement"),this.barrePowerUp.scale.setTo(0,.3),this.barrePowerUp.tint=16711680,this.barrePowerUp.anchor.set(0,0),this.barrePowerUp.fixedToCamera=!0},modifierScore:function(e){this.scoreTxt.position.x=this.game.width/2,this.scoreTxt.position.y=this.game.height,this.score+=e,this.game.add.tween(this.scoreTxt.cameraOffset).to({x:this.scoreTxt.position.x,y:this.scoreTxt.position.y+5},50,Phaser.Easing.Default,!0,0,0,!0)},creerCarteJeu:function(e,t,i){e="undefined"==typeof e?Phaser.ArrayUtils.getRandomItem(JEU_PACMAN_RUNNER.CARTES_NIVEAUX):e,t="undefined"==typeof t?JEU_PACMAN_RUNNER.TAILLE_TUILE*JEU_PACMAN_RUNNER.LARGEUR_CARTE+this.positionDeroulement:t,i="undefined"==typeof i?!0:i;for(var s=0;s<this.carteGauche.length;s++)this.carteGauche[s].destroy();this.carteGauche=this.carteDroite.concat(),this.carteDroite=[];for(var a,r,o,s=0;s<e.length;s++)r=s%JEU_PACMAN_RUNNER.LARGEUR_CARTE*JEU_PACMAN_RUNNER.TAILLE_TUILE+t,o=Math.floor(s/JEU_PACMAN_RUNNER.LARGEUR_CARTE)*JEU_PACMAN_RUNNER.TAILLE_TUILE,a=this.couches.carte.create(r,o,"tuiles_32"),a.frame=e[s],0==a.frame?(a.type="mur",this.game.physics.enable(a,Phaser.Physics.ARCADE),a.body.immovable=!0):a.type="sol",this.carteDroite[s]=a;this.nbFantomesMax+=.5,i&&this.creerObjetsCarte()},creerObjetsCarte:function(){var e=Math.ceil(Math.random()*this.nbFantomesMax);console.log(this.nbFantomesMax);for(var t=0;e>t;t++)new Fantome(this.game,this.couches.fantomes,this.carteDroite,150);for(var i=Math.ceil(Math.random()*JEU_PACMAN_RUNNER.NB_GOMMES_MAX),t=0;i>t;t++)new Gomme(this.game,this.couches.gommes,this.carteDroite)},mangerGomme:function(e,t){t.superGomme&&this.pacman.activerPowerUp(),t.manger(),this.modifierScore(1e3)},deroulerJeu:function(){this.positionDeroulement++,this.game.camera.focusOnXY(this.positionDeroulement+this.game.width/2,this.game.height/2),this.positionDeroulement%(JEU_PACMAN_RUNNER.TAILLE_TUILE*JEU_PACMAN_RUNNER.LARGEUR_CARTE)==0&&this.creerCarteJeu(),this.pacman.x<=-this.pacman.width+this.positionDeroulement&&this.allerFinJeu()},afficherInfos:function(){this.score++,this.scoreTxt.text="SCORE : "+this.score,this.tempsEcoule=Math.floor(this.game.time.totalElapsedSeconds()),this.tempsTxt.text="TEMPS ÉCOULÉ : "+Math.floor(this.tempsEcoule/60)+":"+(this.tempsEcoule%60<10?"0"+this.tempsEcoule%60:this.tempsEcoule%60)},update:function(){this.deroulerJeu(),this.afficherInfos(),this.pacman.gererDeplacement(this.positionDeroulement),this.pacman.powerUp&&this.pacman.updateDureePowerUp(this.barrePowerUp),this.game.physics.arcade.collide(this.pacman,[this.murs.droit,this.murs.haut,this.murs.bas]),this.game.physics.arcade.collide(this.couches.fantomes,[this.murs.haut,this.murs.bas,this.couches.carte],this.gererDirectionFantome,null,this),this.game.physics.arcade.collide(this.pacman,this.couches.carte,this.gererCollisionTuile,null,this),this.game.physics.arcade.collide(this.pacman,this.couches.fantomes,this.gererCollisionFantome,null,this),this.game.physics.arcade.collide(this.pacman,this.couches.gommes,this.mangerGomme,null,this)},gererDirectionFantome:function(e,t){"mur"!=t.type?t.changerDirection():e.changerDirection()},gererCollisionFantome:function(e,t){this.pacman.powerUp?(t.manger(),this.modifierScore(5e3)):this.allerFinJeu()},gererCollisionTuile:function(e,t){this.pacman.powerUp&&(t.destroy(),this.sonTuile.play(),this.modifierScore(200))},allerFinJeu:function(){for(var e=0;e<this.carteGauche.length;e++)this.carteGauche[e].destroy(),this.carteDroite[e].destroy();this.pacman.desactiverPowerUp(),this.game.state.start("fin",!0,!1,this.score,this.temps)}};